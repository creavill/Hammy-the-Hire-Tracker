# Hammy the Hire Tracker - Docker Compose Configuration
#
# Quick Start:
#   1. Copy config.example.yaml to config.yaml and fill in your information
#   2. Copy .env.example to .env and add your ANTHROPIC_API_KEY
#   3. Place your resumes in the resumes/ directory
#   4. Run: docker-compose up -d
#   5. Access dashboard at http://localhost:5000
#
# Gmail Setup:
#   - First run will require OAuth authentication in the browser
#   - Your credentials.json should be in the project root
#   - The generated token.json will be saved to the ./data volume

version: '3.8'

services:
  hammy:
    build: .
    container_name: hammy-hire-tracker
    ports:
      - "5000:5000"
    volumes:
      # Configuration files
      - ./config.yaml:/app/config.yaml:ro
      - ./.env:/app/.env:ro

      # Gmail OAuth credentials (read-only)
      - ./credentials.json:/app/credentials.json:ro

      # Persistent data (database, token, backups)
      - ./data:/app/data
      - ./data/jobs.db:/app/jobs.db
      - ./data/token.json:/app/token.json
      - ./data/backups:/app/backups

      # Resumes directory (read-only to prevent accidental modification)
      - ./resumes:/app/resumes:ro

      # Generated cover letters
      - ./cover_letters:/app/cover_letters

    environment:
      # Load API key from .env file
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

      # Optional: Override database path
      # - DB_PATH=/app/data/jobs.db

    restart: unless-stopped

    # Health check configuration
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000').read()"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3

# Optional: Create a named volume for data persistence
volumes:
  hammy-data:
    driver: local
